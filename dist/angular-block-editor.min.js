(function(){"use strict";angular.module("ngBlockEditor",[]).provider("BlockEditorRegistry",function(){var e;return e={},this.registerBlockType=function(t,o){return o.type=t,e[t]=o},this.$get=[function(){return{getBlockTypes:function(){return e}}}],this}).controller("BlockEditorTextController",["$scope","$sce",function(e,t){return e.trustedHtmlCode=t.trustAsHtml}]).controller("BlockEditorEmbedController",["$scope","$sce","$block",function(e,t,o){var n;return e.embeddables=[{provider:"youtube",displayName:"YouTube",regex:/https?:\/\/www.youtube.com\/watch\?v=([a-zA-Z0-9_-]*)/},{provider:"soundcloud",displayName:"SoundCloud",regex:/https?:\/\/(soundcloud.com\/[a-zA-Z0-9\/_-]*)/}],e.pattern=null,e.isValid=!1,e.trustedConcat=function(){var e;return e=Array.prototype.slice.call(arguments),t.trustAsResourceUrl(e.join(""))},n=function(){var t;return null!=e.pattern&&null!=(null!=(t=o.content)?t.url:void 0)?(e.contentId=e.pattern.exec(o.content.url)[1],e.isValid=e.pattern.test(o.content.url)):(e.contentId=void 0,e.isValid=!1)},e.$watch("block.content.provider",function(t){return t&&(e.pattern=_.findWhere(e.embeddables,{provider:t}).regex),n()}),e.$watch("block.content.url",n)}]).config(["BlockEditorRegistryProvider",function(e){return e.registerBlockType("text",{displayName:"Text",editTemplate:"ng-block-editor/edit/text.html",previewTemplate:"ng-block-editor/preview/text.html",controller:"BlockEditorTextController"}),e.registerBlockType("link",{displayName:"Link",editTemplate:"ng-block-editor/edit/link.html",previewTemplate:"ng-block-editor/preview/link.html"}),e.registerBlockType("embed",{displayName:"Embed",editTemplate:"ng-block-editor/edit/embed.html",previewTemplate:"ng-block-editor/preview/embed.html",controller:"BlockEditorEmbedController"})}]).directive("blockEditor",["BlockEditorRegistryProvider",function(e){var t;return t=e.getBlockTypes(),{restrict:"E",templateUrl:"ng-block-editor/editor.html",require:["blockEditor","ngModel"],scope:{ngModel:"=ngModel",ngDisabled:"="},controller:["$scope",function(e){var t,o,n;return t={},o=function(t){return _.indexOf(e.blocks,t)},n=function(){return _.each(e.blocks,function(t,o){return t.canMoveUp=o>0,t.canMoveDown=o<e.blocks.length-1})},this.addBlock=function(t){return e.blocks.push(t)},this.editBlock=function(n){return t[n]=_.cloneDeep(n),e.blocks[o(n)].editing=!0},this.submitBlockEdit=function(t){return t=e.blocks[o(t)],t.saved=!0,t.editing=!1},this.rollbackBlockEdit=function(n){var r;return n=e.blocks[o(n)],n.saved?(r=_.cloneDeep(t[n]),_.merge(n,r),delete t[n]):this.removeBlock(n)},this.removeBlock=function(t){return e.blocks=_.without(e.blocks,t)},this.moveUp=function(t){var r,c,l;return t.canMoveUp&&(c=o(t),c>0)?(r=e.blocks[c],l=e.blocks[c-1],e.blocks.splice(c-1,2,r,l),n()):void 0},this.moveDown=function(t){var r,c,l;return t.canMoveDown&&(c=o(t),c<e.blocks.length-1)?(r=e.blocks[c],l=e.blocks[c+1],e.blocks.splice(c,2,l,r),n()):void 0}}],link:function(e,o,n,r){var c,l,i;return l=r[0],i=r[1],c="block-editor-"+(new Date).getTime(),o.addClass("block-editor"),o.attr("id",c),i.$formatters.push(function(t){var o;return o=angular.copy(t),_.each(o,function(e,t){return e.saved=!0,e.canMoveUp=t>0,e.canMoveDown=t<o.length-1}),e.blocks=o}),i.$parsers.push(function(e){var t;return t=_.map(e,function(e){return _.omit(e,["saved","editing","canMoveUp","canMoveDown"])})}),i.$isEmpty=function(e){return _.isArray(e)&&e.length>0},e.blockTypes=t,e.startAddingNewBlock=function(){return e.addingNewBlock=!0},e.cancelAddingNewBlock=function(){return e.addingNewBlock=!1},e.addNew=function(t){var o;return o={kind:t,content:{},saved:!1},l.addBlock(o),l.editBlock(o),e.addingNewBlock=!1},e.$watch("blocks",function(e){return i.$setViewValue(_.cloneDeep(e))},!0)}}}]).directive("blockEditorBlock",["$sce","$controller","BlockEditorRegistry",function(e,t,o){return{restrict:"E",templateUrl:"ng-block-editor/block.html",require:"^blockEditor",scope:{block:"=",editEnabled:"@edit"},link:function(e,n,r,c){var l,i;return n.addClass("block-editor-block"),e.config=o.getBlockTypes()[e.block.kind],e.edit=function(){return c.editBlock(e.block)},e.remove=function(){return c.removeBlock(e.block)},e.moveUp=function(){return c.moveUp(e.block)},e.moveDown=function(){return c.moveDown(e.block)},e.save=function(){return c.submitBlockEdit(e.block)},e.cancel=function(){return c.rollbackBlockEdit(e.block)},null!=e.config.controller?(i={$scope:e,$block:e.block,$editor:c},l=t(e.config.controller,i)):void 0}}}])}).call(this);
!function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("block.html",'<div class="row block-editor-block-edit" ng-show="block.editing"><div class="col-sm-12"><div ng-include="config.editTemplate"></div></div></div><div class="row block-editor-block-preview" ng-hide="block.editing"><div class="col-sm-10"><div ng-include="config.previewTemplate"></div></div><div class="col-sm-2 block-editor-block-toggles" ng-show="editEnabled != \'false\'"><a href="" ng-click="moveUp()" ng-class="{\'block-editor-block-toggle-disabled\': ! block.canMoveUp}"><i class="glyphicon glyphicon-arrow-up"></i></a> <a href="" ng-click="moveDown()" ng-class="{\'block-editor-block-toggle-disabled\': ! block.canMoveDown}"><i class="glyphicon glyphicon-arrow-down"></i></a> <a href="" ng-click="edit()"><i class="glyphicon glyphicon-pencil"></i></a> <a href="" class="text-danger" ng-click="remove()"><i class="glyphicon glyphicon-remove"></i></a></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("editor.html",'<d-block-editor-block block="block" ng-repeat="block in blocks" edit="{{ ! ngDisabled }}"></d-block-editor-block><div class="block-editor-toolbar"><div ng-hide="addingNewBlock"><a href="" ng-click="startAddingNewBlock()" ng-hide="ngDisabled">Add a new block</a> <span ng-show="blocks && blocks.length > 0">|&nbsp;<a href="" ng-click="renderFullPreview()">Preview</a></span></div><div ng-show="addingNewBlock"><a ng-repeat="blockType in blockTypes" href="" class="btn btn-default btn-sm" role="button" ng-click="addNew(blockType.type)"><i class="glyphicon glyphicon-plus"></i> &nbsp;{{ blockType.displayName }}</a> <a href="" ng-click="cancelAddingNewBlock()">Cancel</a></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview.html",'<div class="block-editor-preview"><d-block-editor-block block="block" edit="false" ng-repeat="block in blocks"></d-block-editor-block></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("edit/attachment.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Label</label><div class="col-sm-10"><input type="text" class="form-control" ng-model="block.content.label" required></div></div><div class="form-group"><label class="col-sm-2 control-label">File</label><div class="col-sm-10"><a ng-show="block.content.cloudinary" href="{{ block.content.cloudinary.secure_url }}" target="_blank">{{ block.content.cloudinary.secure_url }}</a> <a class="btn btn-default btn-sm" ng-show="! inProgress" ngf-accept="\'image/*\'" ngf-select ngf-change="upload($files, $rejectedFiles, \'Please select an image.\')"><span ng-hide="block.content.cloudinary">Upload file</span> <span ng-show="block.content.cloudinary">Upload a different file</span></a><div class="progress" ng-show="inProgress"><div class="progress-bar" role="progressbar" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress }}%">Uploading ...</div></div></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-show="block.content.cloudinary" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("edit/embed.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Service</label><div class="col-sm-10"><select ng-model="block.content.provider" class="form-control" ng-options="e.provider as e.displayName for e in embeddables" required></select></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" ng-model="block.content.url" class="form-control" required ng-pattern="e.regex"></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="! isValid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("edit/image.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><cl-image ng-show="block.content.cloudinary" public-id="{{ block.content.cloudinary.public_id }}" class="thumbnail inline"><cl-transformation height="200" width="200" crop="fit"></cl-image><div class="progress" ng-show="inProgress"><div class="progress-bar" role="progressbar" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress }}%">Uploading ...</div></div></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a class="btn btn-default btn-sm" ng-show="! inProgress" ngf-accept="\'image/*\'" ngf-select ngf-change="upload($files, $rejectedFiles, \'Please select an image.\')"><span ng-hide="block.content.cloudinary">Upload image</span> <span ng-show="block.content.cloudinary">Upload a different image</span></a> <a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-show="block.content.cloudinary"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("edit/link.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Label</label><div class="col-sm-10"><input type="text" class="form-control" ng-model="block.content.label"></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" class="form-control" ng-model="block.content.url" required></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("edit/text.html",'<div ng-form="form" class="form-horizontal"><div text-angular ta-toolbar="[[\'h2\',\'h3\'],[\'bold\',\'italics\'],[\'quote\']]" ng-model="block.content.html" required></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/attachment.html",'<i class="glyphicon glyphicon-paperclip">&nbsp;</i><a href="{{ block.content.cloudinary.secure_url }}" target="_blank">{{ block.content.label || block.content.cloudinary.secure_url }}</a>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/embed.html","<ng-include ng-if=\"isValid\" src=\"'components/block-editor/preview/embed/' + block.content.provider + '.html'\"></ng-include>")}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/image.html",'<cl-image public-id="{{ block.content.cloudinary.public_id }}" class="thumbnail inline"><cl-transformation height="200" width="200" crop="fit"></cl-image>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/link.html",'<a href="{{ block.content.url }}" target="_blank">{{ block.content.label || block.content.url }}</a>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/text.html",'<div ng-bind-html="trustedHtmlCode(block.content.html)"></div>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/embed/soundcloud.html",'<iframe width="100%" height="450" scrolling="no" frameborder="no" src="{{ trustedConcat(\'https://w.soundcloud.com/player/?url=https://\', contentId, \'&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true\') }}"></iframe>')}])}(),function(l){try{l=angular.module("ngBlockEditor")}catch(o){l=angular.module("ngBlockEditor",[])}l.run(["$templateCache",function(l){"use strict";l.put("preview/embed/youtube.html",'<iframe width="420" height="315" src="{{ trustedConcat(\'http://www.youtube.com/embed/\', contentId) }}"></iframe>')}])}();