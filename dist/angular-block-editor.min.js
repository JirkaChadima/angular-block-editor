(function(){var e=[].indexOf||function(e){for(var o=0,t=this.length;t>o;o++)if(o in this&&this[o]===e)return o;return-1};angular.module("ngBlockEditor",["ngSanitize"]).provider("BlockEditor",function(){var e,o;this.blockTypes={},this.editorTemplateUrl="ng-block-editor/editor.html",this.blockTemplateUrl="ng-block-editor/block.html",this.dragAndDropEnabled=!1,this.toolbar=[],this.messages={removeBlockConfirm:"Are you sure you want to remove this block?"};try{angular.module("angular-sortable-view"),this.dragAndDropEnabled=!0}catch(t){e=t,this.dragAndDropEnabled=!1}return this.registerBlockType=function(e,o){return o.type=e,this.blockTypes[e]=o},o=this,this.$get=["$injector","$log",function(e,t){return{editorTemplateUrl:o.editorTemplateUrl,blockTemplateUrl:o.blockTemplateUrl,blockTypes:o.blockTypes,dragAndDropEnabled:o.dragAndDropEnabled,toolbar:o.toolbar,getMessage:function(r,n,l){return null==o.messages[r]&&t.error("[ngBlockEditor] No message with _id "+r),_.isFunction(o.messages[r])||_.isArray(o.messages[r])?e.invoke(o.messages[r],{$editor:n,$block:l}):o.messages[r]}}}],this}).controller("BlockEditorTextController",["$scope","$sce",function(e,o){return e.trustedHtmlCode=o.trustAsHtml}]).controller("BlockEditorEmbedController",["$scope","$sce","$block",function(e,o,t){var r;return e.embeddables=[{provider:"youtube",displayName:"YouTube",regex:/https?:\/\/www.youtube.com\/watch\?v=([a-zA-Z0-9_-]*)/},{provider:"soundcloud",displayName:"SoundCloud",regex:/https?:\/\/(soundcloud.com\/[a-zA-Z0-9\/_-]*)/}],e.pattern=null,e.isValid=!1,e.trustedConcat=function(){var e;return e=Array.prototype.slice.call(arguments),o.trustAsResourceUrl(e.join(""))},r=_.debounce(function(){var o;return null!=e.pattern&&null!=(null!=(o=t.content)?o.url:void 0)?(e.contentId=e.pattern.exec(t.content.url)[1],e.isValid=e.pattern.test(t.content.url)):(e.contentId=void 0,e.isValid=!1)},1e3),e.$watch("block.content.provider",function(o){return o&&(e.pattern=_.findWhere(e.embeddables,{provider:o}).regex),r()}),e.$watch("block.content.url",r)}]).config(["BlockEditorProvider",function(e){return e.registerBlockType("text",{icon:"glyphicon glyphicon-align-justify",displayName:"Text",editTemplate:"ng-block-editor/edit/text.html",previewTemplate:"ng-block-editor/preview/text.html",editController:"BlockEditorTextController",renderController:"BlockEditorTextController"}),e.registerBlockType("link",{icon:"glyphicon glyphicon-link",displayName:"Link",editTemplate:"ng-block-editor/edit/link.html",previewTemplate:"ng-block-editor/preview/link.html"}),e.registerBlockType("embed",{icon:"glyphicon glyphicon-facetime-video",displayName:"Embed",editTemplate:"ng-block-editor/edit/embed.html",previewTemplate:"ng-block-editor/preview/embed.html",editController:"BlockEditorEmbedController",renderController:"BlockEditorTextController"}),e.toolbar=["text","link","embed"]}]).directive("beEditor",["BlockEditor",function(o){var t;return t=o.blockTypes,{restrict:"E",templateUrl:o.editorTemplateUrl,require:["beEditor","ngModel"],scope:{toolbar:"=",ngModel:"=ngModel",ngDisabled:"="},controller:["$scope",function(e){var o,t;return o={},t=function(){return _.each(e.blocks,function(o,t){return o.canMoveUp=t>0,o.canMoveDown=t<e.blocks.length-1})},this.addBlock=function(o){return e.blocks.push(o),t()},this.editBlock=function(e){return o[e.$$hashKey]=_.cloneDeep(e),e.editing=!0},this.submitBlockEdit=function(e){return e.saved=!0,e.editing=!1},this.rollbackBlockEdit=function(e){var t;return e.saved?(t=_.cloneDeep(o[e.$$hashKey]),_.forOwn(t,function(o,t){return e[t]=o}),_.forOwn(e,function(o,r){return _.has(t,r)?void 0:delete e[r]}),delete o[e],e.editing=!1):this.removeBlock(e)},this.removeBlock=function(o){return e.blocks=_.without(e.blocks,o),t()},this.moveUp=function(o){var r,n,l;return o.canMoveUp&&(n=_.indexOf(e.blocks,o),n>0)?(r=e.blocks[n],l=e.blocks[n-1],e.blocks.splice(n-1,2,r,l),t()):void 0},this.moveDown=function(o){var r,n,l;return o.canMoveDown&&(n=_.indexOf(e.blocks,o),n<e.blocks.length-1)?(r=e.blocks[n],l=e.blocks[n+1],e.blocks.splice(n,2,l,r),t()):void 0}}],link:function(r,n,l,i){var c,d,a,s;return a=i[0],s=i[1],c="be-editor-"+(new Date).getTime(),n.addClass("be-editor"),n.attr("id",c),s.$formatters.push(function(e){var o;return o=angular.copy(e||[]),_.each(o,function(e,t){return e.saved=!0,e.canMoveUp=t>0,e.canMoveDown=t<o.length-1}),r.blocks=o}),s.$parsers.push(function(e){var o;return o=_.map(e,function(e){return _.omit(e,["saved","editing","canMoveUp","canMoveDown"])})}),s.$isEmpty=function(e){return _.isArray(e)&&e.length>0},d=r.toolbar||o.toolbar,r.blockTypes=_(t).filter(function(o){return function(){var t;return t=o.type,e.call(d,t)>=0}}).sortBy(function(e){return _.indexOf(d,e.type)}).value(),r.dragAndDropEnabled=o.dragAndDropEnabled,r.startAddingNewBlock=function(){return r.addingNewBlock=!0},r.cancelAddingNewBlock=function(){return r.addingNewBlock=!1},r.addNew=function(e){var o;return o={kind:e,content:{},saved:!1},a.addBlock(o),a.editBlock(o),r.addingNewBlock=!1},r.$watch("blocks",function(e){return s.$setViewValue(_.cloneDeep(e))},!0)}}}]).directive("beBlock",["$window","$log","$controller","BlockEditor",function(e,o,t,r){return{restrict:"E",templateUrl:r.blockTemplateUrl,require:"^beEditor",scope:{block:"=",editEnabled:"@edit"},link:function(n,l,i,c){var d,a;return l.addClass("be-block"),n.dragAndDropEnabled=r.dragAndDropEnabled,n.config=r.blockTypes[n.block.kind],n.config?(n.edit=function(){return c.editBlock(n.block)},n.remove=function(){return e.confirm(r.getMessage("removeBlockConfirm",c,n.block))?c.removeBlock(n.block):void 0},n.moveUp=function(){return c.moveUp(n.block)},n.moveDown=function(){return c.moveDown(n.block)},n.save=function(){return c.submitBlockEdit(n.block)},n.cancel=function(){return c.rollbackBlockEdit(n.block)},null!=n.config.editController?(a={$scope:n,$block:n.block,$editor:c},d=t(n.config.editController,a)):void 0):void o.error("[ngBlockEditor] Unknown block type: "+n.block.kind)}}}]).directive("beRender",function(){return{restrict:"EA",template:'<div be-render-block="block" ng-repeat="block in blocks"></div>',scope:{blocks:"=beRender"},link:function(e,o,t){return o.addClass("be-render")}}}).directive("beRenderBlock",["$controller","BlockEditor",function(e,o){return{restrict:"EA",template:'<div ng-include="config.previewTemplate"></div>',scope:{block:"=beRenderBlock"},replace:!0,link:function(t,r,n){var l,i;return r.addClass("be-render-block"),t.config=o.blockTypes[t.block.kind],t.config?null!=t.config.renderController?(i={$scope:t,$block:t.block},l=e(t.config.renderController,i)):void 0:void $log.error("[ngBlockEditor] Unknown block type: "+t.block.kind)}}}])}).call(this);
angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/block.html",'<div class="row be-block-edit" ng-show="block.editing"><div class="col-sm-12"><div ng-include="config.editTemplate"></div></div></div><div class="row be-block-preview" ng-hide="block.editing"><div class="col-sm-1" ng-show="dragAndDropEnabled"><i class="glyphicon glyphicon-menu-hamburger" sv-handle></i></div><div class="col-sm-9"><div ng-include="config.previewTemplate"></div></div><div class="be-block-toggles" ng-class="{\'col-sm-3\': ! dragAndDropEnabled, \'col-sm-2\': dragAndDropEnabled}" role="group" ng-show="editEnabled != \'false\'"><div class="btn-group"><a class="btn btn-default btn-xs" ng-if="! dragAndDropEnabled" href="" ng-click="moveUp()" ng-class="{\'be-block-toggle-disabled\': ! block.canMoveUp}"><i class="glyphicon glyphicon-arrow-up"></i></a> <a class="btn btn-default btn-xs" ng-if="! dragAndDropEnabled" href="" ng-click="moveDown()" ng-class="{\'be-block-toggle-disabled\': ! block.canMoveDown}"><i class="glyphicon glyphicon-arrow-down"></i></a> <a class="btn btn-default btn-xs" href="" ng-click="edit()"><i class="glyphicon glyphicon-pencil"></i></a> <a class="btn btn-danger btn-xs" href="" class="text-danger" ng-click="remove()"><i class="glyphicon glyphicon-remove"></i></a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/editor.html",'<div sv-root sv-part="blocks"><be-block block="block" ng-repeat="block in blocks" edit="{{ ! ngDisabled }}" sv-element></be-block><div class="be-toolbar"><div ng-hide="addingNewBlock"><a href="" class="btn btn-default" ng-click="startAddingNewBlock()" ng-hide="ngDisabled">Add a new block</a></div><div ng-show="addingNewBlock"><a ng-repeat="blockType in ::blockTypes" href="" class="btn btn-default btn-sm" role="button" ng-click="addNew(blockType.type)"><i ng-class="::blockType.icon" ng-show="::blockType.icon"></i> &nbsp;{{ ::blockType.displayName }}</a> <a href="" ng-click="cancelAddingNewBlock()">Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/embed.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Service</label><div class="col-sm-10"><select ng-model="block.content.provider" class="form-control" ng-options="e.provider as e.displayName for e in embeddables" required></select></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" ng-model="block.content.url" class="form-control" required ng-pattern="pattern"></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="! isValid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/link.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Label</label><div class="col-sm-10"><input type="text" class="form-control" ng-model="block.content.label"></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" class="form-control" ng-model="block.content.url" required></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/text.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Text</label><div class="col-sm-10"><textarea class="form-control" ng-model="block.content.html" required></textarea></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed.html","<ng-include ng-if=\"isValid\" src=\"'ng-block-editor/preview/embed/' + block.content.provider + '.html'\"></ng-include>")}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/link.html",'<a href="{{ block.content.url }}" target="_blank">{{ block.content.label || block.content.url }}</a>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/text.html",'<div ng-bind-html="trustedHtmlCode(block.content.html)"></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/soundcloud.html",'<iframe width="100%" height="450" scrolling="no" frameborder="no" src="{{ trustedConcat(\'https://w.soundcloud.com/player/?url=https://\', contentId, \'&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true\') }}"></iframe>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/youtube.html",'<iframe width="100%" height="450" src="{{ trustedConcat(\'http://www.youtube.com/embed/\', contentId) }}"></iframe>')}]);