(function(){var e=[].indexOf||function(e){for(var o=0,t=this.length;t>o;o++)if(o in this&&this[o]===e)return o;return-1};angular.module("ngBlockEditor",["ngSanitize"]).provider("BlockEditorRegistry",function(){var e;return e={},this.registerBlockType=function(o,t){return t.type=o,e[o]=t},this.$get=[function(){return{getBlockTypes:function(){return e}}}],this}).controller("BlockEditorTextController",["$scope","$sce",function(e,o){return e.trustedHtmlCode=o.trustAsHtml}]).controller("BlockEditorEmbedController",["$scope","$sce","$block",function(e,o,t){var n;return e.embeddables=[{provider:"youtube",displayName:"YouTube",regex:/https?:\/\/www.youtube.com\/watch\?v=([a-zA-Z0-9_-]*)/},{provider:"soundcloud",displayName:"SoundCloud",regex:/https?:\/\/(soundcloud.com\/[a-zA-Z0-9\/_-]*)/}],e.pattern=null,e.isValid=!1,e.trustedConcat=function(){var e;return e=Array.prototype.slice.call(arguments),o.trustAsResourceUrl(e.join(""))},n=function(){var o;return null!=e.pattern&&null!=(null!=(o=t.content)?o.url:void 0)?(e.contentId=e.pattern.exec(t.content.url)[1],e.isValid=e.pattern.test(t.content.url)):(e.contentId=void 0,e.isValid=!1)},e.$watch("block.content.provider",function(o){return o&&(e.pattern=_.findWhere(e.embeddables,{provider:o}).regex),n()}),e.$watch("block.content.url",n)}]).config(["BlockEditorRegistryProvider",function(e){return e.registerBlockType("text",{icon:"glyphicon glyphicon-align-justify",displayName:"Text",editTemplate:"ng-block-editor/edit/text.html",previewTemplate:"ng-block-editor/preview/text.html",controller:"BlockEditorTextController"}),e.registerBlockType("link",{icon:"glyphicon glyphicon-link",displayName:"Link",editTemplate:"ng-block-editor/edit/link.html",previewTemplate:"ng-block-editor/preview/link.html"}),e.registerBlockType("embed",{icon:"glyphicon glyphicon-facetime-video",displayName:"Embed",editTemplate:"ng-block-editor/edit/embed.html",previewTemplate:"ng-block-editor/preview/embed.html",controller:"BlockEditorEmbedController"})}]).directive("blockEditor",["BlockEditorRegistry",function(o){var t;return t=o.getBlockTypes(),{restrict:"E",templateUrl:"ng-block-editor/editor.html",require:["blockEditor","ngModel"],scope:{enabledBlockTypes:"=blocks",ngModel:"=ngModel",ngDisabled:"="},controller:["$scope",function(e){var o,t,n;return o={},t=function(o){return _.indexOf(e.blocks,o)},n=function(){return _.each(e.blocks,function(o,t){return o.canMoveUp=t>0,o.canMoveDown=t<e.blocks.length-1})},this.addBlock=function(o){return e.blocks.push(o)},this.editBlock=function(n){return o[n.$$hashKey]=_.cloneDeep(n),e.blocks[t(n)].editing=!0},this.submitBlockEdit=function(o){return o=e.blocks[t(o)],o.saved=!0,o.editing=!1},this.rollbackBlockEdit=function(n){var r;return n=e.blocks[t(n)],n.saved?(r=_.cloneDeep(o[n.$$hashKey]),_.merge(n,r),delete o[n],n.editing=!1):this.removeBlock(n)},this.removeBlock=function(o){return e.blocks=_.without(e.blocks,o)},this.moveUp=function(o){var r,c,l;return o.canMoveUp&&(c=t(o),c>0)?(r=e.blocks[c],l=e.blocks[c-1],e.blocks.splice(c-1,2,r,l),n()):void 0},this.moveDown=function(o){var r,c,l;return o.canMoveDown&&(c=t(o),c<e.blocks.length-1)?(r=e.blocks[c],l=e.blocks[c+1],e.blocks.splice(c,2,l,r),n()):void 0}}],link:function(o,n,r,c){var l,i,d;return i=c[0],d=c[1],l="block-editor-"+(new Date).getTime(),n.addClass("block-editor"),n.attr("id",l),d.$formatters.push(function(e){var t;return t=angular.copy(e),_.each(t,function(e,o){return e.saved=!0,e.canMoveUp=o>0,e.canMoveDown=o<t.length-1}),o.blocks=t}),d.$parsers.push(function(e){var o;return o=_.map(e,function(e){return _.omit(e,["saved","editing","canMoveUp","canMoveDown"])})}),d.$isEmpty=function(e){return _.isArray(e)&&e.length>0},o.blockTypes=o.enabledBlockTypes?_.filter(t,function(t){var n;return n=t.type,e.call(o.enabledBlockTypes,n)>=0}):t,o.startAddingNewBlock=function(){return o.addingNewBlock=!0},o.cancelAddingNewBlock=function(){return o.addingNewBlock=!1},o.addNew=function(e){var t;return t={kind:e,content:{},saved:!1},i.addBlock(t),i.editBlock(t),o.addingNewBlock=!1},o.$watch("blocks",function(e){return d.$setViewValue(_.cloneDeep(e))},!0)}}}]).directive("blockEditorBlock",["$window","$sce","$log","$controller","BlockEditorRegistry",function(e,o,t,n,r){return{restrict:"E",templateUrl:"ng-block-editor/block.html",require:"^blockEditor",scope:{block:"=",editEnabled:"@edit"},link:function(o,c,l,i){var d,u;return c.addClass("block-editor-block"),o.config=r.getBlockTypes()[o.block.kind],o.config?(o.edit=function(){return i.editBlock(o.block)},o.remove=function(){return e.confirm("Are you sure you want to remove this block?")?i.removeBlock(o.block):void 0},o.moveUp=function(){return i.moveUp(o.block)},o.moveDown=function(){return i.moveDown(o.block)},o.save=function(){return i.submitBlockEdit(o.block)},o.cancel=function(){return i.rollbackBlockEdit(o.block)},null!=o.config.controller?(u={$scope:o,$block:o.block,$editor:i},d=n(o.config.controller,u)):void 0):void t.error("[ngBlockEditor] Unknown block type: "+o.block.kind)}}}])}).call(this);
angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/block.html",'<div class="row block-editor-block-edit" ng-show="block.editing"><div class="col-sm-12"><div ng-include="config.editTemplate"></div></div></div><div class="row block-editor-block-preview" ng-hide="block.editing"><div class="col-sm-10"><div ng-include="config.previewTemplate"></div></div><div class="col-sm-2 block-editor-block-toggles" ng-show="editEnabled != \'false\'"><a href="" ng-click="moveUp()" ng-class="{\'block-editor-block-toggle-disabled\': ! block.canMoveUp}"><i class="glyphicon glyphicon-arrow-up"></i></a> <a href="" ng-click="moveDown()" ng-class="{\'block-editor-block-toggle-disabled\': ! block.canMoveDown}"><i class="glyphicon glyphicon-arrow-down"></i></a> <a href="" ng-click="edit()"><i class="glyphicon glyphicon-pencil"></i></a> <a href="" class="text-danger" ng-click="remove()"><i class="glyphicon glyphicon-remove"></i></a></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/editor.html",'<block-editor-block block="block" ng-repeat="block in blocks" edit="{{ ! ngDisabled }}"></block-editor-block><div class="block-editor-toolbar"><div ng-hide="addingNewBlock"><a href="" ng-click="startAddingNewBlock()" ng-hide="ngDisabled">Add a new block</a></div><div ng-show="addingNewBlock"><a ng-repeat="blockType in ::blockTypes" href="" class="btn btn-default btn-sm" role="button" ng-click="addNew(blockType.type)"><i ng-class="::blockType.icon" ng-show="::blockType.icon"></i> &nbsp;{{ ::blockType.displayName }}</a> <a href="" ng-click="cancelAddingNewBlock()">Cancel</a></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview.html",'<div class="block-editor-preview"><d-block-editor-block block="block" edit="false" ng-repeat="block in blocks"></d-block-editor-block></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/embed.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Service</label><div class="col-sm-10"><select ng-model="block.content.provider" class="form-control" ng-options="e.provider as e.displayName for e in embeddables" required></select></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" ng-model="block.content.url" class="form-control" required ng-pattern="e.regex"></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="! isValid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/link.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Label</label><div class="col-sm-10"><input type="text" class="form-control" ng-model="block.content.label"></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" class="form-control" ng-model="block.content.url" required></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/text.html",'<div ng-form="form" class="form-horizontal"><textarea ng-model="block.content.html" required></textarea><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed.html","<ng-include ng-if=\"isValid\" src=\"'ng-block-editor/preview/embed/' + block.content.provider + '.html'\"></ng-include>")}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/link.html",'<a href="{{ block.content.url }}" target="_blank">{{ block.content.label || block.content.url }}</a>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/text.html",'<div ng-bind-html="trustedHtmlCode(block.content.html)"></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/soundcloud.html",'<iframe width="100%" height="450" scrolling="no" frameborder="no" src="{{ trustedConcat(\'https://w.soundcloud.com/player/?url=https://\', contentId, \'&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true\') }}"></iframe>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/youtube.html",'<iframe width="420" height="315" src="{{ trustedConcat(\'http://www.youtube.com/embed/\', contentId) }}"></iframe>')}]);