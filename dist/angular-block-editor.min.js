(function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("ngBlockEditor",["ngSanitize"]).provider("BlockEditorRegistry",function(){var e;return e={},this.registerBlockType=function(t,o){return o.type=t,e[t]=o},this.$get=[function(){return{getBlockTypes:function(){return e}}}],this}).controller("BlockEditorTextController",["$scope","$sce",function(e,t){return e.trustedHtmlCode=t.trustAsHtml}]).controller("BlockEditorEmbedController",["$scope","$sce","$block",function(e,t,o){var n;return e.embeddables=[{provider:"youtube",displayName:"YouTube",regex:/https?:\/\/www.youtube.com\/watch\?v=([a-zA-Z0-9_-]*)/},{provider:"soundcloud",displayName:"SoundCloud",regex:/https?:\/\/(soundcloud.com\/[a-zA-Z0-9\/_-]*)/}],e.pattern=null,e.isValid=!1,e.trustedConcat=function(){var e;return e=Array.prototype.slice.call(arguments),t.trustAsResourceUrl(e.join(""))},n=function(){var t;return null!=e.pattern&&null!=(null!=(t=o.content)?t.url:void 0)?(e.contentId=e.pattern.exec(o.content.url)[1],e.isValid=e.pattern.test(o.content.url)):(e.contentId=void 0,e.isValid=!1)},e.$watch("block.content.provider",function(t){return t&&(e.pattern=_.findWhere(e.embeddables,{provider:t}).regex),n()}),e.$watch("block.content.url",n)}]).config(["BlockEditorRegistryProvider",function(e){return e.registerBlockType("text",{displayName:"Text",editTemplate:"ng-block-editor/edit/text.html",previewTemplate:"ng-block-editor/preview/text.html",controller:"BlockEditorTextController"}),e.registerBlockType("link",{displayName:"Link",editTemplate:"ng-block-editor/edit/link.html",previewTemplate:"ng-block-editor/preview/link.html"}),e.registerBlockType("embed",{displayName:"Embed",editTemplate:"ng-block-editor/edit/embed.html",previewTemplate:"ng-block-editor/preview/embed.html",controller:"BlockEditorEmbedController"})}]).directive("blockEditor",["BlockEditorRegistry",function(t){var o;return o=t.getBlockTypes(),{restrict:"E",templateUrl:"ng-block-editor/editor.html",require:["blockEditor","ngModel"],scope:{enabledBlockTypes:"=blocks",ngModel:"=ngModel",ngDisabled:"="},controller:["$scope",function(e){var t,o,n;return t={},o=function(t){return _.indexOf(e.blocks,t)},n=function(){return _.each(e.blocks,function(t,o){return t.canMoveUp=o>0,t.canMoveDown=o<e.blocks.length-1})},this.addBlock=function(t){return e.blocks.push(t)},this.editBlock=function(n){return t[n]=_.cloneDeep(n),e.blocks[o(n)].editing=!0},this.submitBlockEdit=function(t){return t=e.blocks[o(t)],t.saved=!0,t.editing=!1},this.rollbackBlockEdit=function(n){var r;return n=e.blocks[o(n)],n.saved?(r=_.cloneDeep(t[n]),_.merge(n,r),delete t[n]):this.removeBlock(n)},this.removeBlock=function(t){return e.blocks=_.without(e.blocks,t)},this.moveUp=function(t){var r,l,c;return t.canMoveUp&&(l=o(t),l>0)?(r=e.blocks[l],c=e.blocks[l-1],e.blocks.splice(l-1,2,r,c),n()):void 0},this.moveDown=function(t){var r,l,c;return t.canMoveDown&&(l=o(t),l<e.blocks.length-1)?(r=e.blocks[l],c=e.blocks[l+1],e.blocks.splice(l,2,c,r),n()):void 0}}],link:function(t,n,r,l){var c,i,d;return i=l[0],d=l[1],c="block-editor-"+(new Date).getTime(),n.addClass("block-editor"),n.attr("id",c),d.$formatters.push(function(e){var o;return o=angular.copy(e),_.each(o,function(e,t){return e.saved=!0,e.canMoveUp=t>0,e.canMoveDown=t<o.length-1}),t.blocks=o}),d.$parsers.push(function(e){var t;return t=_.map(e,function(e){return _.omit(e,["saved","editing","canMoveUp","canMoveDown"])})}),d.$isEmpty=function(e){return _.isArray(e)&&e.length>0},t.blockTypes=t.enabledBlockTypes?_.filter(o,function(o){var n;return n=o.type,e.call(t.enabledBlockTypes,n)>=0}):o,t.startAddingNewBlock=function(){return t.addingNewBlock=!0},t.cancelAddingNewBlock=function(){return t.addingNewBlock=!1},t.addNew=function(e){var o;return o={kind:e,content:{},saved:!1},i.addBlock(o),i.editBlock(o),t.addingNewBlock=!1},t.$watch("blocks",function(e){return d.$setViewValue(_.cloneDeep(e))},!0)}}}]).directive("blockEditorBlock",["$sce","$log","$controller","BlockEditorRegistry",function(e,t,o,n){return{restrict:"E",templateUrl:"ng-block-editor/block.html",require:"^blockEditor",scope:{block:"=",editEnabled:"@edit"},link:function(e,r,l,c){var i,d;return r.addClass("block-editor-block"),e.config=n.getBlockTypes()[e.block.kind],e.config?(e.edit=function(){return c.editBlock(e.block)},e.remove=function(){return c.removeBlock(e.block)},e.moveUp=function(){return c.moveUp(e.block)},e.moveDown=function(){return c.moveDown(e.block)},e.save=function(){return c.submitBlockEdit(e.block)},e.cancel=function(){return c.rollbackBlockEdit(e.block)},null!=e.config.controller?(d={$scope:e,$block:e.block,$editor:c},i=o(e.config.controller,d)):void 0):void t.error("[ngBlockEditor] Unknown block type: "+e.block.kind)}}}])}).call(this);
angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/block.html",'<div class="row block-editor-block-edit" ng-show="block.editing"><div class="col-sm-12"><div ng-include="config.editTemplate"></div></div></div><div class="row block-editor-block-preview" ng-hide="block.editing"><div class="col-sm-10"><div ng-include="config.previewTemplate"></div></div><div class="col-sm-2 block-editor-block-toggles" ng-show="editEnabled != \'false\'"><a href="" ng-click="moveUp()" ng-class="{\'block-editor-block-toggle-disabled\': ! block.canMoveUp}"><i class="glyphicon glyphicon-arrow-up"></i></a> <a href="" ng-click="moveDown()" ng-class="{\'block-editor-block-toggle-disabled\': ! block.canMoveDown}"><i class="glyphicon glyphicon-arrow-down"></i></a> <a href="" ng-click="edit()"><i class="glyphicon glyphicon-pencil"></i></a> <a href="" class="text-danger" ng-click="remove()"><i class="glyphicon glyphicon-remove"></i></a></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/editor.html",'<block-editor-block block="block" ng-repeat="block in blocks" edit="{{ ! ngDisabled }}"></block-editor-block><div class="block-editor-toolbar"><div ng-hide="addingNewBlock"><a href="" ng-click="startAddingNewBlock()" ng-hide="ngDisabled">Add a new block</a></div><div ng-show="addingNewBlock"><a ng-repeat="blockType in blockTypes" href="" class="btn btn-default btn-sm" role="button" ng-click="addNew(blockType.type)"><i class="glyphicon glyphicon-plus"></i> &nbsp;{{ blockType.displayName }}</a> <a href="" ng-click="cancelAddingNewBlock()">Cancel</a></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview.html",'<div class="block-editor-preview"><d-block-editor-block block="block" edit="false" ng-repeat="block in blocks"></d-block-editor-block></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/embed.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Service</label><div class="col-sm-10"><select ng-model="block.content.provider" class="form-control" ng-options="e.provider as e.displayName for e in embeddables" required></select></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" ng-model="block.content.url" class="form-control" required ng-pattern="e.regex"></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="! isValid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/link.html",'<div ng-form="form" class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Label</label><div class="col-sm-10"><input type="text" class="form-control" ng-model="block.content.label"></div></div><div class="form-group"><label class="col-sm-2 control-label">URL</label><div class="col-sm-10"><input type="url" class="form-control" ng-model="block.content.url" required></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/edit/text.html",'<div ng-form="form" class="form-horizontal"><textarea ng-model="block.content.html" required></textarea><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><a href="" class="btn btn-primary btn-sm" ng-click="save()" ng-disabled="form.$invalid"><i class="glyphicon glyphicon-ok"></i> &nbsp;Done</a> <a href="" class="btn btn-link btn-sm" ng-click="cancel()"><i class="glyphicon glyphicon-remove"></i> &nbsp;Cancel</a></div></div></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed.html","<ng-include ng-if=\"isValid\" src=\"'ng-block-editor/preview/embed/' + block.content.provider + '.html'\"></ng-include>")}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/link.html",'<a href="{{ block.content.url }}" target="_blank">{{ block.content.label || block.content.url }}</a>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/text.html",'<div ng-bind-html="trustedHtmlCode(block.content.html)"></div>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/soundcloud.html",'<iframe width="100%" height="450" scrolling="no" frameborder="no" src="{{ trustedConcat(\'https://w.soundcloud.com/player/?url=https://\', contentId, \'&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true\') }}"></iframe>')}]),angular.module("ngBlockEditor").run(["$templateCache",function(l){l.put("ng-block-editor/preview/embed/youtube.html",'<iframe width="420" height="315" src="{{ trustedConcat(\'http://www.youtube.com/embed/\', contentId) }}"></iframe>')}]);